# Ticketing Platform Microservices (Spring Boot)

## 1. Overview
This project is a scalable, event-driven microservices architecture for a ticketing platform built with **Java 17 / Spring Boot 3**. It handles user authentication, dynamic routing, booking management, and event inventory updates using asynchronous communication.

### Key Features
* **Dynamic API Gateway (Spring Cloud Gateway):** Database-driven routing with role-based access control (RBAC).
* **Event-Driven Consistency:** Uses the **Transactional Outbox Pattern** to ensure data consistency between PostgreSQL and Kafka.
* **Centralized Auth:** Keycloak integration for Identity and Access Management (IAM).
* **Docker Compose:** Fully containerized setup with health checks and internal networking.

---

## 2. Architecture

### High-Level Architecture Diagram

```
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚    Client/Browser   â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â”‚ HTTP + JWT
                                               â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚      KEYCLOAK (Port 8088)          â”‚
                          â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                          â”‚   â”‚  â€¢ User Authentication     â”‚   â”‚
                          â”‚   â”‚  â€¢ JWT Token Generation    â”‚   â”‚
                          â”‚   â”‚  â€¢ Role Management         â”‚   â”‚
                          â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚ JWT Token
                                           â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   API GATEWAY (Port 8083)          â”‚
                          â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                          â”‚   â”‚  â€¢ JWT Validation          â”‚   â”‚
                          â”‚   â”‚  â€¢ Dynamic Routing         â”‚   â”‚
                          â”‚   â”‚  â€¢ RBAC                    â”‚   â”‚
                          â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                          â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
                            â”‚              â”‚              â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                          â”‚                          â”‚
                â–¼                          â–¼                          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  BOOKING SERVICE     â”‚  â”‚   EVENT SERVICE      â”‚  â”‚   USER SERVICE       â”‚
    â”‚    (Port 8081)       â”‚  â”‚    (Port 8082)       â”‚  â”‚    (Port 8084)       â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚ â€¢ Bookings     â”‚  â”‚  â”‚  â”‚ â€¢ Venues       â”‚  â”‚  â”‚  â”‚ â€¢ User Profile â”‚  â”‚
    â”‚  â”‚ â€¢ Payments     â”‚  â”‚  â”‚  â”‚ â€¢ Events       â”‚  â”‚  â”‚  â”‚ â€¢ Registration â”‚  â”‚
    â”‚  â”‚ â€¢ Outbox       â”‚  â”‚  â”‚  â”‚ â€¢ Tickets      â”‚  â”‚  â”‚  â”‚                â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                         â”‚                         â”‚
               â–¼                         â–¼                         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    booking_db        â”‚  â”‚     event_db         â”‚  â”‚      user_db         â”‚
    â”‚   (PostgreSQL)       â”‚  â”‚   (PostgreSQL)       â”‚  â”‚   (PostgreSQL)       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ Outbox Scheduler (5s)
               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚              KAFKA BROKER (Port 9092)                   â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚  Topics:                                          â”‚  â”‚
    â”‚  â”‚  â€¢ booking.events                                 â”‚  â”‚
    â”‚  â”‚  â€¢ event.updates                                  â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚ Consumes
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   EVENT SERVICE        â”‚
                    â”‚   Kafka Consumer       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Service Breakdown

| Service | Technology | Port | Responsibility |
| :--- | :--- | :--- | :--- |
| **API Gateway** | Spring Cloud Gateway | `8083` | Entry point. Handles routing lookup, JWT validation, and RBAC. |
| **Booking Service** | Spring Boot / Data JPA | `8081` | Manages orders. Implements the **Outbox Producer**. |
| **Event Service** | Spring Boot / Data JPA | `8082` | Manages Venues/Events. Implements the **Kafka Consumer**. |
| **Keycloak** | OIDC Provider | `8088` | Handles user login, registration, and token generation. |
| **Kafka** | Message Broker | `9092` | Decouples the Booking service from the Event service. |

---

## 3. Database Entity Relationship Diagrams (ERD)

### API Gateway Database (`gateway_db`)

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘            api_routes                      â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ â€¢ id                UUID (PK)              â•‘
â•‘ â€¢ path_prefix       VARCHAR(255)           â•‘
â•‘ â€¢ http_method       VARCHAR(20)            â•‘
â•‘ â€¢ target_base_url   VARCHAR(255)           â•‘
â•‘ â€¢ required_role     VARCHAR(50)            â•‘
â•‘ â€¢ created_at        TIMESTAMP              â•‘
â•‘ â€¢ updated_at        TIMESTAMP              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### Event Service Database (`event_db`)

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              venues                        â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ â€¢ id            UUID (PK)                  â•‘
â•‘ â€¢ name          VARCHAR(255)               â•‘
â•‘ â€¢ address       VARCHAR(255)               â•‘
â•‘ â€¢ city          VARCHAR(100)               â•‘
â•‘ â€¢ capacity      INT                        â•‘
â•‘ â€¢ created_at    TIMESTAMP                  â•‘
â•‘ â€¢ updated_at    TIMESTAMP                  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    â”‚
                    â”‚ 1:N
                    â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              events                        â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ â€¢ id             UUID (PK)                 â•‘
â•‘ â€¢ organizer_id   VARCHAR(255)              â•‘
â•‘ â€¢ venue_id       UUID (FK â†’ venues)        â•‘
â•‘ â€¢ title          VARCHAR(255)              â•‘
â•‘ â€¢ description    TEXT                      â•‘
â•‘ â€¢ category       VARCHAR(64)               â•‘
â•‘ â€¢ start_time     TIMESTAMP                 â•‘
â•‘ â€¢ end_time       TIMESTAMP                 â•‘
â•‘ â€¢ status         VARCHAR(32)               â•‘
â•‘ â€¢ created_at     TIMESTAMP                 â•‘
â•‘ â€¢ updated_at     TIMESTAMP                 â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    â”‚
                    â”‚ 1:N
                    â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           ticket_types                     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ â€¢ id                  UUID (PK)            â•‘
â•‘ â€¢ event_id            UUID (FK â†’ events)   â•‘
â•‘ â€¢ name                VARCHAR(100)         â•‘
â•‘ â€¢ price               NUMERIC(10,2)        â•‘
â•‘ â€¢ currency            VARCHAR(16)          â•‘
â•‘ â€¢ total_quantity      INT                  â•‘
â•‘ â€¢ remaining_quantity  INT                  â•‘
â•‘ â€¢ created_at          TIMESTAMP            â•‘
â•‘ â€¢ updated_at          TIMESTAMP            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### Booking Service Database (`booking_db`)

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘             bookings                       â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ â€¢ id              UUID (PK)                â•‘
â•‘ â€¢ user_id         UUID                     â•‘
â•‘ â€¢ event_id        UUID                     â•‘
â•‘ â€¢ status          VARCHAR(32)              â•‘
â•‘ â€¢ total_amount    NUMERIC(10,2)            â•‘
â•‘ â€¢ currency        VARCHAR(16)              â•‘
â•‘ â€¢ payment_status  VARCHAR(32)              â•‘
â•‘ â€¢ payment_ref     VARCHAR(255)             â•‘
â•‘ â€¢ created_at      TIMESTAMP                â•‘
â•‘ â€¢ updated_at      TIMESTAMP                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    â”‚
                    â”‚ 1:N
                    â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘          booking_items                     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ â€¢ id              UUID (PK)                â•‘
â•‘ â€¢ booking_id      UUID (FK â†’ bookings)     â•‘
â•‘ â€¢ ticket_type_id  UUID                     â•‘
â•‘ â€¢ quantity        INT                      â•‘
â•‘ â€¢ unit_price      NUMERIC(10,2)            â•‘
â•‘ â€¢ total_price     NUMERIC(10,2)            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘          outbox_events                     â•‘
â•‘      (Transactional Outbox)                â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ â€¢ id              UUID (PK)                â•‘
â•‘ â€¢ aggregate_type  VARCHAR(64)              â•‘
â•‘ â€¢ aggregate_id    UUID                     â•‘
â•‘ â€¢ event_type      VARCHAR(64)              â•‘
â•‘ â€¢ payload         JSONB                    â•‘
â•‘ â€¢ status          VARCHAR(32)              â•‘
â•‘ â€¢ created_at      TIMESTAMP                â•‘
â•‘ â€¢ processed_at    TIMESTAMP                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## 4. Kafka Event Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      BOOKING SERVICE                              â”‚
â”‚                                                                   â”‚
â”‚  User Request â†’ Create Booking                                   â”‚
â”‚         â”‚                                                         â”‚
â”‚         â–¼                                                         â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“         â”‚
â”‚  â”ƒ     @Transactional saveBooking()                    â”ƒ         â”‚
â”‚  â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”ƒ         â”‚
â”‚  â”ƒ  â”‚ 1. INSERT INTO bookings                      â”‚  â”ƒ         â”‚
â”‚  â”ƒ  â”‚ 2. INSERT INTO booking_items                 â”‚  â”ƒ         â”‚
â”‚  â”ƒ  â”‚ 3. INSERT INTO outbox_events                 â”‚  â”ƒ         â”‚
â”‚  â”ƒ  â”‚    - status: 'PENDING'                       â”‚  â”ƒ         â”‚
â”‚  â”ƒ  â”‚    - event_type: 'BOOKING_CREATED'           â”‚  â”ƒ         â”‚
â”‚  â”ƒ  â”‚    - payload: {booking details}              â”‚  â”ƒ         â”‚
â”‚  â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”ƒ         â”‚
â”‚  â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›         â”‚
â”‚         â”‚                                                         â”‚
â”‚         â”‚ COMMIT (All or Nothing)                                â”‚
â”‚         â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  OutboxScheduler (@Scheduled fixedDelay = 5000ms)          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ 1. SELECT * FROM outbox_events                       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    WHERE status = 'PENDING'                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ 2. FOR EACH event:                                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â†’ Send to Kafka                                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â†’ UPDATE status = 'PUBLISHED'                     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â†’ SET processed_at = NOW()                        â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ Kafka Message
          â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â””â–ºâ”‚ Topic: booking.events                 â”‚
            â”‚ Key: booking-uuid                     â”‚
            â”‚ Value: {                              â”‚
            â”‚   "eventType": "BOOKING_CREATED",     â”‚
            â”‚   "bookingId": "...",                 â”‚
            â”‚   "eventId": "...",                   â”‚
            â”‚   "items": [...]                      â”‚
            â”‚ }                                     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚         KAFKA BROKER (Port 9092)                    â”‚
          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
          â”‚  â”‚  ðŸ“‹ booking.events                            â”‚  â”‚
          â”‚  â”‚     - BOOKING_CREATED                         â”‚  â”‚
          â”‚  â”‚     - BOOKING_CANCELLED                       â”‚  â”‚
          â”‚  â”‚     - BOOKING_CONFIRMED                       â”‚  â”‚
          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ Consumer Group: event-service-group
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      EVENT SERVICE                                â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  @KafkaListener(topics = "booking.events")                 â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  handleBookingEvent(BookingEvent event) {                 â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚    switch(event.getEventType()) {                         â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚      case BOOKING_CREATED:                                â”‚  â”‚
â”‚  â”‚        // Decrease ticket inventory                       â”‚  â”‚
â”‚  â”‚        UPDATE ticket_types                                â”‚  â”‚
â”‚  â”‚        SET remaining_quantity -= qty                      â”‚  â”‚
â”‚  â”‚        WHERE id = ticket_type_id                          â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚      case BOOKING_CANCELLED:                              â”‚  â”‚
â”‚  â”‚        // Restore ticket inventory                        â”‚  â”‚
â”‚  â”‚        UPDATE ticket_types                                â”‚  â”‚
â”‚  â”‚        SET remaining_quantity += qty                      â”‚  â”‚
â”‚  â”‚        WHERE id = ticket_type_id                          â”‚  â”‚
â”‚  â”‚    }                                                      â”‚  â”‚
â”‚  â”‚  }                                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ“ Guaranteed Delivery    âœ“ Eventual Consistency    âœ“ Decoupling
```

**Key Benefits:**
- **Guaranteed Delivery:** Outbox pattern ensures events are never lost
- **Eventual Consistency:** Services stay in sync asynchronously
- **Decoupling:** Services don't need to know about each other
- **Scalability:** Can add more consumers without changing producers

---

## 5. Keycloak Integration Flow

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  STEP 1: User Login & Token Generation                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚   Client    â”‚                              â”‚    Keycloak      â”‚
  â”‚   (User)    â”‚                              â”‚   Port 8088      â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                              â”‚
         â”‚  POST /realms/ticketing-realm/protocol/...  â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
         â”‚  â”‚ grant_type: password                 â”‚   â”‚
         â”‚  â”‚ username: testuser                   â”‚   â”‚
         â”‚  â”‚ password: password                   â”‚   â”‚
         â”‚  â”‚ client_id: ticketing-client          â”‚   â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
         â”‚                                              â”‚
         â”‚                                              â”‚ âœ“ Validate
         â”‚                                              â”‚   Credentials
         â”‚                                              â”‚
         â”‚  â—„ JWT Token Response                       â”‚
         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
         â”‚  â”‚ access_token: eyJhbGci...            â”‚   â”‚
         â”‚  â”‚ token_type: Bearer                   â”‚   â”‚
         â”‚  â”‚ expires_in: 300                      â”‚   â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
         â”‚                                              â”‚

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  STEP 2: API Request with JWT Validation                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚   Client    â”‚       â”‚  API Gateway   â”‚       â”‚    Keycloak      â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â”‚   Port 8083    â”‚       â”‚   Port 8088      â”‚
         â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                        â”‚
         â”‚  POST /api/v1/bookings                         â”‚
         â”‚  Authorization: Bearer eyJhbGci...             â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                        â”‚
         â”‚                       â”‚                        â”‚
         â”‚                       â”‚ â‘  Validate JWT         â”‚
         â”‚                       â”‚   â€¢ Check signature    â”‚
         â”‚                       â”‚   â€¢ Check expiration   â”‚
         â”‚                       â”‚   â€¢ Extract roles      â”‚
         â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
         â”‚                       â”‚                        â”‚
         â”‚                       â”‚ â—„ JWKS (Public Keys)   â”‚
         â”‚                       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚                       â”‚                        â”‚
         â”‚                       â”‚ â‘¡ Lookup Route         â”‚
         â”‚                       â”‚   FROM api_routes      â”‚
         â”‚                       â”‚   WHERE path = '/api/v1/bookings'
         â”‚                       â”‚                        â”‚
         â”‚                       â”‚ â‘¢ Check RBAC           â”‚
         â”‚                       â”‚   required: USER       â”‚
         â”‚                       â”‚   user has: [USER]     â”‚
         â”‚                       â”‚   âœ“ Authorized         â”‚
         â”‚                       â”‚                        â”‚

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  STEP 3: Forward to Backend Service                                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

         â”‚                       â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                       â”‚              â”‚  Booking Service     â”‚
         â”‚                       â”‚              â”‚    Port 8081         â”‚
         â”‚                       â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                         â”‚
         â”‚                       â”‚ â‘£ Forward Request       â”‚
         â”‚                       â”‚  POST http://booking-service:8081/...
         â”‚                       â”‚  + JWT in header        â”‚
         â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
         â”‚                       â”‚                         â”‚
         â”‚                       â”‚                         â”‚ âš™ Process
         â”‚                       â”‚                         â”‚   Business
         â”‚                       â”‚                         â”‚   Logic
         â”‚                       â”‚                         â”‚
         â”‚                       â”‚ â—„ 201 Created           â”‚
         â”‚                       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚                       â”‚   { "bookingId": "..." }â”‚
         â”‚                       â”‚                         â”‚
         â”‚  â—„ Response           â”‚                         â”‚
         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                         â”‚
         â”‚   { "bookingId": "..." }                        â”‚
         â”‚                       â”‚                         â”‚
```

**Security Features:**
- **JWT Validation:** API Gateway verifies token signature using Keycloak's public keys
- **Role-Based Access Control:** Each route can specify required roles (USER, ADMIN, etc.)
- **Token Expiration:** Tokens expire after 5 minutes (configurable)
- **Centralized Auth:** All services trust Keycloak as the single source of truth

---

## 6. Keycloak Configuration (Critical)

Because this system runs in Docker, we deal with "Split Horizon" DNS.

1.  **Browser (You):** Accesses Keycloak at `http://localhost:8088`. The JWT Token `iss` (issuer) claim will be `http://localhost:8088...`.
2.  **API Gateway (Docker):** Needs to verify the token signature. It cannot talk to `localhost` (that would be itself). It must talk to the container named `keycloak`.

This is handled in the API Gateway's `docker-compose` environment variables:

```yaml
# 1. The token claims it comes from here (Validation check)
SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_ISSUER_URI: http://localhost:8088/realms/ticketing-realm

# 2. But we fetch the public keys from here (Physical network location)
SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_JWK_SET_URI: http://keycloak:8088/realms/ticketing-realm/protocol/openid-connect/certs
```

-----

## 7\. Folder Structure (Spring Boot Standard)

```text
/project-root
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ postgres-init.sql
â”œâ”€â”€ /api-gateway
â”‚   â”œâ”€â”€ src/main/java/com/example/gateway
â”‚   â”‚   â”œâ”€â”€ config       # SecurityConfig.java (OAuth2)
â”‚   â”‚   â”œâ”€â”€ model        # ApiRoute.java
â”‚   â”‚   â”œâ”€â”€ repository   # RouteRepository.java
â”‚   â”‚   â””â”€â”€ service      # DynamicRouteLocator.java
â”‚   â””â”€â”€ Dockerfile
â”œâ”€â”€ /booking-service
â”‚   â”œâ”€â”€ src/main/java/com/example/booking
â”‚   â”‚   â”œâ”€â”€ controller
â”‚   â”‚   â”œâ”€â”€ service      # BookingService (writes to DB + Outbox)
â”‚   â”‚   â”œâ”€â”€ kafka        # OutboxScheduler.java (Polls DB -> Kafka)
â”‚   â”‚   â””â”€â”€ entity       # Booking.java, OutboxEvent.java
â”‚   â””â”€â”€ Dockerfile
â”œâ”€â”€ /event-service
â”‚   â”œâ”€â”€ src/main/java/com/example/event
â”‚   â”‚   â”œâ”€â”€ kafka        # KafkaConsumer.java (@KafkaListener)
â”‚   â”‚   â””â”€â”€ service      # InventoryService.java
â”‚   â””â”€â”€ Dockerfile
```

## 8\. API Usage Example

**1. Create a Route (SQL in `gateway_db`)**
Connect to the Postgres container to run this:

```sql
INSERT INTO api_routes (id, path_prefix, http_method, target_base_url, required_role)
VALUES (gen_random_uuid(), '/api/v1/bookings', 'POST', 'http://booking-service:8081', 'USER');
```

**2. Get Token**

```bash
TOKEN=$(curl -s -d "client_id=ticketing-client" -d "username=testuser" -d "password=password" -d "grant_type=password" \
  http://localhost:8088/realms/ticketing-realm/protocol/openid-connect/token | jq -r .access_token)
```

**3. Call API**

```bash
curl -X POST http://localhost:8083/api/v1/bookings \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "event_id": "123",
    "items": [{"ticket_type_id": "abc", "quantity": 1}]
  }'
```
